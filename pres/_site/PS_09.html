<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>APIs, time-series, and weather Data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="externals/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="externals/reveal.js-3.3.0.1/css/theme/sky.css" id="theme">


  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }


  </style>

    <style type="text/css">code{white-space: pre;}</style>

    <link rel="stylesheet" href="reveal.css"/>

<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

    <script src="externals/header-attrs/header-attrs.js"></script>
    <link href="externals/font-awesome/css/all.css" rel="stylesheet" />
    <link href="externals/font-awesome/css/v4-shims.css" rel="stylesheet" />
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">APIs, time-series, and weather Data</h1>
</section>

<section id="course-schedule" class="slide level2">
<h2>Course Schedule</h2>
<iframe src="http://geo511.wilsonlab.io/Schedule.html" width="100%" height="800">
</iframe>
<p><a href="http://geo511.wilsonlab.io/Schedule.html">source</a></p>
</section>
<section id="final-projects" class="slide level2">
<h2>Final Projects</h2>
<ul>
<li>Only 8 folks have published their sites…</li>
<li>Start moving your project proposal content into your website
<ul>
<li>Title</li>
<li>Introduction</li>
<li>etc…</li>
</ul></li>
</ul>
</section>
<section id="resource-presentations" class="slide level2">
<h2>Resource Presentations</h2>
<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQJhWvxt2xNq8t0SWWfUKM5Th3aT_bJWfL71Zoyf1JbysDknpfGfInw8_SonjhivIyRMC3DPfa-1fLm/pubhtml?gid=868447735&amp;single=true" width="100%" height="800">
</iframe>
<p><a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQJhWvxt2xNq8t0SWWfUKM5Th3aT_bJWfL71Zoyf1JbysDknpfGfInw8_SonjhivIyRMC3DPfa-1fLm/pubhtml?gid=868447735&amp;single=true">source</a></p>
</section>
<section id="case-study-presentations---lets-pick-a-winner" class="slide level2">
<h2>Case Study Presentations - Let’s pick a winner!</h2>
<iframe src="https://wheelofnames.com/bw4-gdt" width="100%" height="500">
</iframe>
<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQJhWvxt2xNq8t0SWWfUKM5Th3aT_bJWfL71Zoyf1JbysDknpfGfInw8_SonjhivIyRMC3DPfa-1fLm/pubhtml?gid=868447735&amp;single=true" style="height: 800px; width: 100%;">
</iframe>
</section>
<section id="next-weeks-case-study" class="slide level2">
<h2>Next Week’s Case Study</h2>
<iframe src="http://wilsonlab.io/GEO511/CS_09.html" width="100%" height="800">
</iframe>
<p><a href="http://wilsonlab.io/GEO511/CS_09.html">source</a></p>
</section>
<section>
<section id="api" class="title-slide slide level1">
<h1>API</h1>

</section>
<section id="application-programming-interface" class="slide level2">
<h2>Application Programming Interface</h2>
<iframe src="https://en.wikipedia.org/wiki/Application_programming_interface" width="100%" height="400px">
</iframe>
<ul>
<li class="fragment">Imagine I wanted to work with Wikipedia content…</li>
</ul>
</section>
<section id="manually-processing-information-from-the-web" class="slide level2">
<h2>Manually processing information from the web</h2>
<ul>
<li>Browse to page, <code>File-&gt;Save As</code>, repeat.</li>
<li>Deal with ugly html stuff…</li>
</ul>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;meta name=&quot;generator&quot; content=&quot;pandoc&quot;&gt;
  &lt;title&gt;APIs, time-series, and weather Data&lt;/title&gt;
  &lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot;&gt;
  &lt;meta name=&quot;apple-mobile-web-app-status-bar-style&quot; content=&quot;black-translucent&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui&quot;&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;externals/reveal.js-3.3.0.1/css/reveal.css&quot;/&gt;</code></pre>
</section>
<section class="slide level2">

<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WikipediR)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>content<span class="ot">=</span><span class="fu">page_content</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">page_name =</span> <span class="st">&quot;Application_programming_interface&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">project=</span><span class="st">&quot;Wikipedia&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">language=</span><span class="st">&quot;en&quot;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">as_wikitext=</span>T)</span></code></pre></div>
</section>
<section id="apis-allow-direct-and-often-custom-sharing-of-data" class="slide level2">
<h2>APIs allow direct (and often custom) sharing of data</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>c1<span class="ot">=</span>content<span class="sc">$</span>parse<span class="sc">$</span>wikitext<span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_split</span>(<span class="fu">boundary</span>(<span class="st">&quot;sentence&quot;</span>),<span class="at">simplify =</span> T)<span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">&quot;&#39;&quot;</span>,<span class="st">&quot;&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">]&quot;</span>,<span class="st">&quot;&quot;</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># results:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(c1[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])</span></code></pre></div>
<pre><code>## NA NA</code></pre>
</section>
<section id="many-data-providers-now-have-apis" class="slide level2">
<h2>Many data providers now have APIs</h2>
<ul>
<li>Government Demographic data (census, etc.)</li>
<li>Government Environmental data</li>
<li>Google, Twitter, etc.</li>
</ul>
</section>
<section id="ropensci" class="slide level2">
<h2>ROpenSci</h2>
<iframe src="https://ropensci.org" width="100%" height="800">
</iframe>
<p><a href="https://ropensci.org">source</a></p>
</section>
<section id="pros-cons" class="slide level2">
<h2>Pros &amp; Cons</h2>
<h3 id="pros">Pros</h3>
<ul>
<li>Get the data you want, when you want it</li>
<li>Automatic updates - just re-run the request</li>
</ul>
<h3 id="cons">Cons</h3>
<ul>
<li>Dependent on real-time access</li>
<li>APIs, permissions, etc. can change and break code</li>
</ul>
</section>
<section id="generic-api-access" class="slide level2">
<h2>Generic API Access</h2>
<ol type="1">
<li>Provide R with a URL to request information</li>
<li>The API sends you back a response
<ul>
<li>JavaScript Object Notation (JSON)</li>
<li>Extensible Markup Language (XML).</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span></code></pre></div>
</section>
<section id="endpoints" class="slide level2">
<h2>Endpoints</h2>
<p>The URL you will request information from.</p>
<ul>
<li>Data.gov API: <a href="https://www.data.gov/developers/apis" class="uri">https://www.data.gov/developers/apis</a></li>
<li>Github API: <a href="https://api.github.com" class="uri">https://api.github.com</a></li>
<li>U.S. Census API: <a href="http://api.census.gov" class="uri">http://api.census.gov</a></li>
</ul>
</section>
<section id="some-r-packages-for-specific-apis" class="slide level2">
<h2>Some R Packages for specific APIs</h2>
</section>
<section id="census-data" class="slide level2">
<h2>Census data</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>net_migration <span class="ot">&lt;-</span> <span class="fu">get_estimates</span>(<span class="at">geography =</span> <span class="st">&quot;county&quot;</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">variables =</span> <span class="st">&quot;RNETMIG&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">geometry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">shift_geo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>net_migration <span class="ot">&lt;-</span> net_migration <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">groups =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    value <span class="sc">&gt;</span> <span class="dv">15</span> <span class="sc">~</span> <span class="st">&quot;+15 and up&quot;</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    value <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;+5 to +15&quot;</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    value <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">5</span> <span class="sc">~</span> <span class="st">&quot;-5 to +5&quot;</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    value <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">15</span> <span class="sc">~</span> <span class="st">&quot;-15 to -5&quot;</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;-15 and below&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> net_migration, <span class="fu">aes</span>(<span class="at">fill =</span> groups, <span class="at">color =</span> groups), <span class="at">lwd =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tidycensus<span class="sc">::</span>state_laea, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;PuOr&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;PuOr&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Net migration per 1000 residents by county&quot;</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;US Census Bureau 2017 Population Estimates&quot;</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Rate&quot;</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Data acquired with the R tidycensus package&quot;</span>)</span></code></pre></div>
</section>
<section id="results" class="slide level2">
<h2>Results</h2>
<pre><code>## Warning: The `shift_geo` argument is deprecated and will be removed in a future release. We
## recommend using `tigris::shift_geometry()` instead.</code></pre>
<pre><code>## Warning: It is deprecated to specify `guide = FALSE` to remove a guide. Please use `guide = &quot;none&quot;`
## instead.</code></pre>
<p><img data-src="PS_09_files/figure-revealjs/census-1.png" /></p>
</section>
<section id="feddata-package" class="slide level2">
<h2><code>FedData</code> package</h2>
<ul>
<li>National Elevation Dataset digital elevation models (1 and 1/3 arc-second; USGS)</li>
<li>National Hydrography Dataset (USGS)</li>
<li>Soil Survey Geographic (SSURGO) database</li>
<li>International Tree Ring Data Bank.</li>
<li>Global Historical Climatology Network (GHCN)</li>
<li>Others</li>
</ul>
</section>
<section id="noaa-apiv2" class="slide level2">
<h2>NOAA APIv2</h2>
<iframe src="https://www.ncdc.noaa.gov/cdo-web/webservices/v2" width="100%" height="400px">
</iframe>
<p><a href="http://www.ncdc.noaa.gov/cdo-web/webservices/v2">National Climatic Data Center application programming interface (API)</a>.</p>
</section>
<section id="rnoaa-package" class="slide level2">
<h2><code>rNOAA</code> package</h2>
<p>Handles downloading data directly from NOAA APIv2.</p>
<ul>
<li><code>buoy_*</code> NOAA Buoy data from the National Buoy Data Center</li>
<li><code>ghcnd_*</code> GHCND daily data from NOAA</li>
<li><code>isd_*</code> ISD/ISH data from NOAA</li>
<li><code>homr_*</code> Historical Observing Metadata Repository</li>
<li><code>ncdc_*</code> NOAA National Climatic Data Center (NCDC)</li>
<li><code>seaice</code> Sea ice</li>
<li><code>storm_</code> Storms (IBTrACS)</li>
<li><code>swdi</code> Severe Weather Data Inventory (SWDI)</li>
<li><code>tornadoes</code> From the NOAA Storm Prediction Center</li>
</ul>
</section></section>
<section>
<section id="global-historical-climatology-network-ghcn" class="title-slide slide level1">
<h1>Global Historical Climatology Network (GHCN)</h1>

</section>
<section id="libraries" class="slide level2">
<h2>Libraries</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># New Packages</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnoaa)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(climdex.pcic)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code></pre></div>
</section>
<section id="station-locations" class="slide level2">
<h2>Station locations</h2>
<p>Download the GHCN station inventory with <code>ghcnd_stations()</code> and convert to <code>sf</code> object. The download can take a minute or two.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>st <span class="ot">=</span> <span class="fu">ghcnd_stations</span>()<span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()<span class="sc">%&gt;%</span>  <span class="co"># remove records with missing values</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>,<span class="st">&quot;latitude&quot;</span>))<span class="sc">%&gt;%</span> <span class="co">#convert to sf</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&quot;</span>)</span></code></pre></div>
<pre><code>## using cached file: ~/Library/Caches/R/noaa_ghcnd/ghcnd-stations.rds</code></pre>
<pre><code>## date created (size, mb): 2021-08-29 22:53:46 (2.142)</code></pre>
<pre><code>## using cached file: ~/Library/Caches/R/noaa_ghcnd/ghcnd-inventory.rds</code></pre>
<pre><code>## date created (size, mb): 2021-08-29 22:54:22 (2.638)</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(st)<span class="sc">%&gt;%</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">elevation</th>
<th style="text-align: left;">state</th>
<th style="text-align: left;">name</th>
<th style="text-align: left;">gsn_flag</th>
<th style="text-align: left;">wmo_id</th>
<th style="text-align: left;">element</th>
<th style="text-align: right;">first_year</th>
<th style="text-align: right;">last_year</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">TMAX</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
<td style="text-align: left;">POINT (-61.7833 17.1167)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
<td style="text-align: left;">POINT (-61.7833 17.1167)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">PRCP</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
<td style="text-align: left;">POINT (-61.7833 17.1167)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">SNOW</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
<td style="text-align: left;">POINT (-61.7833 17.1167)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">SNWD</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
<td style="text-align: left;">POINT (-61.7833 17.1167)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">PGTM</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
<td style="text-align: left;">POINT (-61.7833 17.1167)</td>
</tr>
</tbody>
</table>
</section>
<section id="ghcnd-variables-5-core-values" class="slide level2">
<h2>GHCND Variables: 5 core values</h2>
<ul>
<li><strong>PRCP</strong> Precipitation (tenths of mm)</li>
<li><strong>SNOW</strong> Snowfall (mm)</li>
<li><strong>SNWD</strong> Snow depth (mm)</li>
<li><strong>TMAX</strong> Maximum temperature</li>
<li><strong>TMIN</strong> Minimum temperature</li>
</ul>
</section>
<section class="slide level2">

<h3 id="and-50-others-for-example">And ~50 others! For example:</h3>
<ul>
<li><strong>ACMC</strong> Average cloudiness midnight to midnight from 30-second ceilometer</li>
<li><strong>AWND</strong> Average daily wind speed</li>
<li><strong>FMTM</strong> Time of fastest mile or fastest 1-minute wind</li>
<li><strong>MDSF</strong> Multiday snowfall total</li>
</ul>
</section>
<section id="filter-to-temperature-and-precipitation" class="slide level2">
<h2><code>filter()</code> to temperature and precipitation</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>st_filtered<span class="ot">=</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(st,element<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;TMAX&quot;</span>,<span class="st">&quot;TMIN&quot;</span>,<span class="st">&quot;PRCP&quot;</span>))</span></code></pre></div>
</section>
<section id="map-ghcnd-stations" class="slide level2">
<h2>Map GHCND stations</h2>
<p>First, get a global country polygon</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spData)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(world)</span></code></pre></div>
</section>
<section id="station-locations-1" class="slide level2">
<h2>Station locations</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>map1<span class="ot">=</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>world,<span class="at">inherit.aes =</span> F,<span class="at">size=</span>.<span class="dv">1</span>,<span class="at">fill=</span><span class="st">&quot;grey&quot;</span>,<span class="at">colour=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>element)<span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_bin2d</span>(<span class="at">data=</span>st_filtered,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y=</span><span class="fu">st_coordinates</span>(st_filtered)[,<span class="dv">2</span>],</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x=</span><span class="fu">st_coordinates</span>(st_filtered)[,<span class="dv">1</span>]),<span class="at">bins=</span><span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette=</span><span class="st">&quot;YlOrRd&quot;</span>,<span class="at">trans=</span><span class="st">&quot;log&quot;</span>,<span class="at">direction=</span><span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))<span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>()<span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;&quot;</span>,<span class="at">y=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
</section>
<section class="slide level2">

<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-12-1.png" /></p>
</section>
<section id="download-daily-data-from-ghcn" class="slide level2">
<h2>Download daily data from GHCN</h2>
<p><code>ghcnd()</code> will download a <code>.dly</code> text file for a particular station. But how to choose?</p>
</section>
<section id="geocode-in-ggmap-package-useful-for-geocoding-place-names" class="slide level2">
<h2><code>geocode</code> in ggmap package useful for geocoding place names</h2>
<p>Geocodes a location (find latitude and longitude) using either (1) the Data Science Toolkit (<a href="http://www.datasciencetoolkit.org/about" class="uri">http://www.datasciencetoolkit.org/about</a>) or (2) Google Maps.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geocode</span>(<span class="st">&quot;University at Buffalo, NY&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     lon   lat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 -78.8  43.0</code></pre>
</section>
<section class="slide level2">

<p>However, you have to be careful:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geocode</span>(<span class="st">&quot;Washington&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     lon   lat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 -121.  47.8</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geocode</span>(<span class="st">&quot;Washington D.C.&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     lon   lat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 -77.0  38.9</code></pre>
</section>
<section class="slide level2">

<p>But this is pretty safe for well known and well-defined places.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>buffalo_c<span class="ot">=</span><span class="fu">geocode</span>(<span class="st">&quot;Buffalo International Airport, NY&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>buffalo_c</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     lon   lat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 -78.7  42.9</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>buffalo<span class="ot">=</span>buffalo_c<span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))<span class="sc">%&gt;%</span> <span class="co">#convert to sf</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&quot;</span>)</span></code></pre></div>
</section>
<section class="slide level2">

<p>Now use that location to spatially filter stations.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>buffalo_b<span class="ot">=</span><span class="fu">st_buffer</span>(buffalo, <span class="fl">0.1</span>) <span class="co">#radius of buffer in decimal degrees</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>st1<span class="ot">=</span><span class="fu">st_within</span>(st_filtered,buffalo_b)<span class="sc">%&gt;%</span> <span class="co">#find stations in the buffered polygon</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">1</span>, any) </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(st1)</span></code></pre></div>
<pre><code>##  logi [1:196634] FALSE FALSE FALSE FALSE FALSE FALSE ...</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(st_filtered[st1,])</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">elevation</th>
<th style="text-align: left;">state</th>
<th style="text-align: left;">name</th>
<th style="text-align: left;">gsn_flag</th>
<th style="text-align: left;">wmo_id</th>
<th style="text-align: left;">element</th>
<th style="text-align: right;">first_year</th>
<th style="text-align: right;">last_year</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</section>
<section class="slide level2">

<p>With the station ID, we can download daily data from NOAA.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>d<span class="ot">=</span><span class="fu">meteo_pull_monitors</span>(<span class="at">monitors=</span><span class="fu">c</span>(<span class="st">&quot;USW00014733&quot;</span>),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">var =</span> <span class="fu">c</span>(<span class="st">&quot;TMAX&quot;</span>,<span class="st">&quot;TMIN&quot;</span>,<span class="st">&quot;PRCP&quot;</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">keep_flags =</span> T)</span></code></pre></div>
<pre><code>## using cached file: ~/Library/Caches/R/noaa_ghcnd/USW00014733.dly</code></pre>
<pre><code>## date created (size, mb): 2021-08-29 22:58:37 (8.5)</code></pre>
<pre><code>## file min/max dates: 1938-05-01 / 2021-08-31</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)<span class="sc">%&gt;%</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 3%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 3%" />
<col style="width: 3%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: left;">date</th>
<th style="text-align: left;">mflag_prcp</th>
<th style="text-align: left;">mflag_tmax</th>
<th style="text-align: left;">mflag_tmin</th>
<th style="text-align: left;">prcp</th>
<th style="text-align: left;">qflag_prcp</th>
<th style="text-align: left;">qflag_tmax</th>
<th style="text-align: left;">qflag_tmin</th>
<th style="text-align: left;">sflag_prcp</th>
<th style="text-align: left;">sflag_tmax</th>
<th style="text-align: left;">sflag_tmin</th>
<th style="text-align: left;">tmax</th>
<th style="text-align: left;">tmin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">USW00014733</td>
<td style="text-align: left;">1938-05-01</td>
<td style="text-align: left;">T</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">144</td>
<td style="text-align: left;">39</td>
</tr>
<tr class="even">
<td style="text-align: left;">USW00014733</td>
<td style="text-align: left;">1938-05-02</td>
<td style="text-align: left;">T</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">211</td>
<td style="text-align: left;">83</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USW00014733</td>
<td style="text-align: left;">1938-05-03</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">25</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">167</td>
<td style="text-align: left;">72</td>
</tr>
<tr class="even">
<td style="text-align: left;">USW00014733</td>
<td style="text-align: left;">1938-05-04</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">112</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">206</td>
<td style="text-align: left;">94</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USW00014733</td>
<td style="text-align: left;">1938-05-05</td>
<td style="text-align: left;">T</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">311</td>
<td style="text-align: left;">106</td>
</tr>
<tr class="even">
<td style="text-align: left;">USW00014733</td>
<td style="text-align: left;">1938-05-06</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">64</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">194</td>
<td style="text-align: left;">78</td>
</tr>
</tbody>
</table>
</section>
<section class="slide level2">

<p>See <a href="http://www1.ncdc.noaa.gov/pub/data/cdo/documentation/GHCND_documentation.pdf">CDO Daily Description</a> and raw <a href="http://www1.ncdc.noaa.gov/pub/data/ghcn/daily/readme.txt">GHCND metadata</a> for more details.</p>
</section>
<section id="quality-control-mflag" class="slide level2">
<h2>Quality Control: MFLAG</h2>
<p>Measurement Flag/Attribute</p>
<ul>
<li><strong>Blank</strong> no measurement information applicable</li>
<li><strong>B</strong> precipitation total formed from two twelve-hour totals</li>
<li><strong>H</strong> represents highest or lowest hourly temperature (TMAX or TMIN) or average of hourly values (TAVG)</li>
<li><strong>K</strong> converted from knots</li>
<li>…</li>
</ul>
<p>See <a href="http://www1.ncdc.noaa.gov/pub/data/cdo/documentation/GHCND_documentation.pdf">CDO Description</a></p>
</section>
<section id="quality-control-qflag" class="slide level2">
<h2>Quality Control: QFLAG</h2>
<ul>
<li><strong>Blank</strong> did not fail any quality assurance check</li>
<li><strong>D</strong> failed duplicate check</li>
<li><strong>G</strong> failed gap check</li>
<li><strong>I</strong> failed internal consistency check</li>
<li><strong>K</strong> failed streak/frequent-value check</li>
<li><strong>N</strong> failed naught check</li>
<li><strong>O</strong> failed climatological outlier check</li>
<li><strong>S</strong> failed spatial consistency check</li>
<li><strong>T</strong> failed temporal consistency check</li>
<li><strong>W</strong> temperature too warm for snow</li>
<li>…</li>
</ul>
<p>See <a href="http://www1.ncdc.noaa.gov/pub/data/cdo/documentation/GHCND_documentation.pdf">CDO Description</a></p>
</section>
<section id="quality-control-sflag" class="slide level2">
<h2>Quality Control: SFLAG</h2>
<p>Indicates the source of the data…</p>
</section>
<section id="summarize-qc-flags" class="slide level2">
<h2>Summarize QC flags</h2>
<p>Summarize the QC flags. How many of which type are there? Should we be more conservative?</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(d<span class="sc">$</span>qflag_tmin)  </span></code></pre></div>
<pre><code>## 
##           G     I     S 
## 30427     2     7     3</code></pre>
<ul>
<li><strong>G</strong> failed gap check</li>
<li><strong>I</strong> failed internal consistency check</li>
<li><strong>S</strong> failed spatial consistency check</li>
</ul>
</section>
<section class="slide level2">

<h3 id="filter-with-qc-data-and-change-units">Filter with QC data and change units</h3>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>d_filtered<span class="ot">=</span>d<span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tmax=</span><span class="fu">ifelse</span>(qflag_tmax<span class="sc">!=</span><span class="st">&quot; &quot;</span><span class="sc">|</span>tmax<span class="sc">==-</span><span class="dv">9999</span>,<span class="cn">NA</span>,<span class="fu">as.numeric</span>(tmax)<span class="sc">/</span><span class="dv">10</span>))<span class="sc">%&gt;%</span>  <span class="co"># convert to degrees C</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tmin=</span><span class="fu">ifelse</span>(qflag_tmin<span class="sc">!=</span><span class="st">&quot; &quot;</span><span class="sc">|</span>tmin<span class="sc">==-</span><span class="dv">9999</span>,<span class="cn">NA</span>,<span class="fu">as.numeric</span>(tmin)<span class="sc">/</span><span class="dv">10</span>))<span class="sc">%&gt;%</span>  <span class="co"># convert to degrees C</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prcp=</span><span class="fu">ifelse</span>(qflag_prcp<span class="sc">!=</span><span class="st">&quot; &quot;</span><span class="sc">|</span>prcp<span class="sc">==-</span><span class="dv">9999</span>,<span class="cn">NA</span>,<span class="fu">as.numeric</span>(prcp)))<span class="sc">%&gt;%</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span></code></pre></div>
</section>
<section class="slide level2">

<p>Plot temperatures</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_filtered,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">y=</span>tmax,<span class="at">x=</span>date))<span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>id)</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-20-1.png" /></p>
</section>
<section class="slide level2">

<p>Limit to a few years and plot the daily range and average temperatures.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>d_filtered_recent<span class="ot">=</span><span class="fu">filter</span>(d_filtered,date<span class="sc">&gt;</span><span class="fu">as.Date</span>(<span class="st">&quot;2017-01-01&quot;</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d_filtered_recent,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">ymax=</span>tmax,<span class="at">ymin=</span>tmin,<span class="at">x=</span>date))<span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">col=</span><span class="st">&quot;grey&quot;</span>,<span class="at">fill=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>(tmax<span class="sc">+</span>tmin)<span class="sc">/</span><span class="dv">2</span>),<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 4 row(s) containing missing values (geom_path).</code></pre>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-21-1.png" /></p>
</section>
<section id="zoo-package-for-rolling-functions" class="slide level2">
<h2>Zoo package for rolling functions</h2>
<p>Infrastructure for Regular and Irregular Time Series (Z’s Ordered Observations)</p>
<ul>
<li><code>rollmean()</code>: Rolling mean</li>
<li><code>rollsum()</code>: Rolling sum</li>
<li><code>rollapply()</code>: Custom functions</li>
</ul>
<p>Use rollmean to calculate a rolling 60-day average.</p>
<ul>
<li><code>align</code> whether the index of the result should be left- or right-aligned or centered</li>
</ul>
</section>
<section class="slide level2">

<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>d_rollmean <span class="ot">=</span> d_filtered_recent <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tmax.60 =</span> <span class="fu">rollmean</span>(<span class="at">x =</span> tmax, <span class="dv">60</span>, <span class="at">align =</span> <span class="st">&quot;center&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">tmax.b60 =</span> <span class="fu">rollmean</span>(<span class="at">x =</span> tmax, <span class="dv">60</span>, <span class="at">align =</span> <span class="st">&quot;right&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>))</span></code></pre></div>
</section>
<section class="slide level2">

<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>d_rollmean<span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">ymax=</span>tmax,<span class="at">ymin=</span>tmin,<span class="at">x=</span>date))<span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">fill=</span><span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>(tmin<span class="sc">+</span>tmax)<span class="sc">/</span><span class="dv">2</span>),<span class="at">col=</span><span class="fu">grey</span>(<span class="fl">0.4</span>),<span class="at">size=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>tmax<span class="fl">.60</span>),<span class="at">col=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>tmax.b60),<span class="at">col=</span><span class="st">&quot;darkred&quot;</span>)</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-23-1.png" /></p>
</section></section>
<section>
<section id="time-series-analysis" class="title-slide slide level1">
<h1>Time Series analysis</h1>
<p>Most timeseries functions use the time series class (<code>ts</code>)</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>tmin.ts<span class="ot">=</span><span class="fu">ts</span>(d_filtered_recent<span class="sc">$</span>tmin,<span class="at">frequency =</span> <span class="dv">365</span>)</span></code></pre></div>
</section>
<section id="temporal-autocorrelation" class="slide level2">
<h2>Temporal autocorrelation</h2>
<p>Values are highly correlated!</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d_filtered_recent,<span class="fu">aes</span>(<span class="at">y=</span>tmin,<span class="at">x=</span><span class="fu">lag</span>(tmin)))<span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>, <span class="at">slope=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_point).</code></pre>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-25-1.png" /></p>
</section>
<section id="autocorrelation-functions" class="slide level2">
<h2>Autocorrelation functions</h2>
<ul>
<li>autocorrelation <span class="math inline">\(x\)</span> vs. <span class="math inline">\(x_{t-1}\)</span> (lag=1)</li>
<li>partial autocorrelation. <span class="math inline">\(x\)</span> vs. <span class="math inline">\(x_{n}\)</span> <em>after</em> controlling for correlations <span class="math inline">\(\in t-1:n\)</span></li>
</ul>
</section>
<section id="autocorrelation" class="slide level2">
<h2>Autocorrelation</h2>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(tmin.ts,<span class="at">lag.max =</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">3</span>,<span class="at">na.action =</span> na.exclude )</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-26-1.png" /></p>
</section>
<section class="slide level2">

<h3 id="partial-autocorrelation">Partial Autocorrelation</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(tmin.ts,<span class="at">lag.max =</span> <span class="dv">365</span>,<span class="at">na.action =</span> na.exclude )</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-27-1.png" /></p>
</section></section>
<section>
<section id="trend-analysis" class="title-slide slide level1">
<h1>Trend analysis</h1>

</section>
<section id="group-by-month-season-year-and-decade." class="slide level2">
<h2>Group by month, season, year, and decade.</h2>
<p>How to convert years into ‘decades’?</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1938</span></span></code></pre></div>
<pre><code>## [1] 1938</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="dv">1938</span>,<span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 1940</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">floor</span>(<span class="dv">1938</span><span class="sc">/</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 193</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">floor</span>(<span class="dv">1938</span><span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span> </span></code></pre></div>
<pre><code>## [1] 1930</code></pre>
<p>Now we can make a ‘decade’ grouping variable.</p>
</section>
<section class="slide level2">

<p>Calculate seasonal and decadal mean temperatures.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>d_filtered2<span class="ot">=</span>d_filtered<span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month=</span><span class="fu">as.numeric</span>(<span class="fu">format</span>(date,<span class="st">&quot;%m&quot;</span>)),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">year=</span><span class="fu">as.numeric</span>(<span class="fu">format</span>(date,<span class="st">&quot;%Y&quot;</span>)),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">season=</span><span class="fu">case_when</span>(</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>          month<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">1</span>,<span class="dv">2</span>)<span class="sc">~</span><span class="st">&quot;Winter&quot;</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>          month<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)<span class="sc">~</span><span class="st">&quot;Spring&quot;</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>          month<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>)<span class="sc">~</span><span class="st">&quot;Summer&quot;</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>          month<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>)<span class="sc">~</span><span class="st">&quot;Fall&quot;</span>),</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">dec=</span>(<span class="fu">floor</span>(<span class="fu">as.numeric</span>(<span class="fu">format</span>(date,<span class="st">&quot;%Y&quot;</span>))<span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span>))</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>d_filtered2<span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">select</span>(date,month,year,season,dec,tmax)<span class="sc">%&gt;%</span><span class="fu">head</span>()<span class="sc">%&gt;%</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
<th style="text-align: right;">month</th>
<th style="text-align: right;">year</th>
<th style="text-align: left;">season</th>
<th style="text-align: right;">dec</th>
<th style="text-align: right;">tmax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1938-05-01</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">14.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">1938-05-02</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">21.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1938-05-03</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">16.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">1938-05-04</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">20.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1938-05-05</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">31.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1938-05-06</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">19.4</td>
</tr>
</tbody>
</table>
</section>
<section id="timeseries-models" class="slide level2">
<h2>Timeseries models</h2>
<p>How to assess change? Simple differences?</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>d_filtered2<span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period=</span><span class="fu">ifelse</span>(year<span class="sc">&lt;=</span><span class="dv">1976-01-01</span>,<span class="st">&quot;early&quot;</span>,<span class="st">&quot;late&quot;</span>))<span class="sc">%&gt;%</span> <span class="co">#create two time periods before and after 1976</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(period)<span class="sc">%&gt;%</span>  <span class="co"># divide the data into the two groups</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),    <span class="co"># calculate the means between the two periods</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">tmin=</span><span class="fu">mean</span>(tmin,<span class="at">na.rm=</span>T),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">tmax=</span><span class="fu">mean</span>(tmax,<span class="at">na.rm=</span>T),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">prcp=</span><span class="fu">mean</span>(prcp,<span class="at">na.rm=</span>T))<span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">period</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">tmin</th>
<th style="text-align: right;">tmax</th>
<th style="text-align: right;">prcp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">early</td>
<td style="text-align: right;">13394</td>
<td style="text-align: right;">4.200516</td>
<td style="text-align: right;">13.67306</td>
<td style="text-align: right;">25.09372</td>
</tr>
<tr class="even">
<td style="text-align: left;">late</td>
<td style="text-align: right;">17045</td>
<td style="text-align: right;">4.817294</td>
<td style="text-align: right;">13.77652</td>
<td style="text-align: right;">28.51288</td>
</tr>
</tbody>
</table>
</section>
<section class="slide level2">

<p>But be careful, there were lots of missing data in the beginning of the record</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>d_filtered2<span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)<span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>n))<span class="sc">+</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-31-1.png" /></p>
</section>
<section class="slide level2">

<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which years don&#39;t have complete data?</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>d_filtered2<span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)<span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n<span class="sc">&lt;</span><span class="dv">360</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##    year     n
##   &lt;dbl&gt; &lt;int&gt;
## 1  1938   245
## 2  2021   243</code></pre>
</section>
<section class="slide level2">

<p>Plot 10-year means (excluding years without complete data):</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>d_filtered2<span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">&gt;</span><span class="dv">1938</span>, year<span class="sc">&lt;</span><span class="dv">2021</span>)<span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dec)<span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">tmin=</span><span class="fu">mean</span>(tmin,<span class="at">na.rm=</span>T),</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">tmax=</span><span class="fu">mean</span>(tmax,<span class="at">na.rm=</span>T),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">prcp=</span><span class="fu">mean</span>(prcp,<span class="at">na.rm=</span>T)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>            )<span class="sc">%&gt;%</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>dec,<span class="at">y=</span>tmax))<span class="sc">+</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">&quot;grey&quot;</span>)</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-33-1.png" /></p>
</section>
<section id="look-for-specific-events-was-2020-unusually-hot-in-buffalo-ny" class="slide level2">
<h2>Look for specific events: was 2020 unusually hot in Buffalo, NY?</h2>
<p>Let’s compare 2020 with all the previous years in the dataset. First add ‘day of year’ to the data to facilitate showing all years on the same plot.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>d_filtered2<span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doy=</span><span class="fu">as.numeric</span>(<span class="fu">format</span>(date,<span class="st">&quot;%j&quot;</span>)),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">doydate=</span><span class="fu">as.Date</span>(<span class="fu">paste</span>(<span class="st">&quot;2020-&quot;</span>,doy),<span class="at">format=</span><span class="st">&quot;%Y-%j&quot;</span>))</span></code></pre></div>
</section>
<section class="slide level2">

<p>Then plot all years (in grey) and add 2020 in red.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df,<span class="fu">aes</span>(<span class="at">x=</span>doydate,<span class="at">y=</span>tmax,<span class="at">group=</span>year))<span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">&quot;grey&quot;</span>,<span class="at">alpha=</span>.<span class="dv">5</span>)<span class="sc">+</span> <span class="co"># plot each year in grey</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">group=</span><span class="dv">1</span>),<span class="at">col=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span>   <span class="co"># Add a smooth GAM to estimate the long-term mean</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span><span class="fu">filter</span>(df,year<span class="sc">==</span><span class="dv">2020</span>),<span class="at">col=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span>  <span class="co"># add 2017 in red</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">labels =</span> <span class="fu">date_format</span>(<span class="st">&quot;%b&quot;</span>),<span class="at">date_breaks =</span> <span class="st">&quot;2 months&quot;</span>) <span class="sc">+</span> </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Day of year&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-35-1.png" /></p>
</section>
<section class="slide level2">

<p>Then ‘zoom’ into just the past few months and add 2019 in red.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df,<span class="fu">aes</span>(<span class="at">x=</span>doydate,<span class="at">y=</span>tmax,<span class="at">group=</span>year))<span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">&quot;grey&quot;</span>,<span class="at">alpha=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">group=</span><span class="dv">1</span>),<span class="at">col=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span><span class="fu">filter</span>(df,year<span class="sc">==</span><span class="dv">2019</span>),<span class="at">col=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">labels =</span> <span class="fu">date_format</span>(<span class="st">&quot;%b&quot;</span>),<span class="at">date_breaks =</span> <span class="st">&quot;2 months&quot;</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">lim=</span><span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2019-08-01&quot;</span>),<span class="fu">as.Date</span>(<span class="st">&quot;2019-10-31&quot;</span>)))</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-36-1.png" /></p>
</section>
<section id="summarize-by-season" class="slide level2">
<h2>Summarize by season</h2>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>seasonal<span class="ot">=</span>d_filtered2<span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,season)<span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">tmin=</span><span class="fu">mean</span>(tmin),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">tmax=</span><span class="fu">mean</span>(tmax),</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">prcp=</span><span class="fu">mean</span>(prcp))<span class="sc">%&gt;%</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n<span class="sc">&gt;</span><span class="dv">75</span>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the `.groups` argument.</code></pre>
</section>
<section id="seasonal-trends" class="slide level2">
<h2>Seasonal Trends</h2>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seasonal,<span class="fu">aes</span>(<span class="at">y=</span>tmin,<span class="at">x=</span>year))<span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>season,<span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span>T)<span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-38-1.png" /></p>
</section>
<section id="fit-a-linear-model-to-a-single-season" class="slide level2">
<h2>Fit a linear model to a single season</h2>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>lm1<span class="ot">=</span>seasonal<span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season<span class="sc">==</span><span class="st">&quot;Summer&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(tmin<span class="sc">~</span>year,<span class="at">data=</span>.)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1)<span class="sc">$</span>r.squared</span></code></pre></div>
<pre><code>## [1] 0.2820857</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lm1)<span class="sc">%&gt;%</span><span class="fu">kable</span>() </span></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-27.3354783</td>
<td style="text-align: right;">7.6402074</td>
<td style="text-align: right;">-3.577845</td>
<td style="text-align: right;">0.0005919</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: right;">0.0216391</td>
<td style="text-align: right;">0.0038596</td>
<td style="text-align: right;">5.606596</td>
<td style="text-align: right;">0.0000003</td>
</tr>
</tbody>
</table>
</section>
<section id="linear-regression-for-each-season" class="slide level2">
<h2>Linear regression for <em>each</em> season</h2>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a lm model for each group</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  d_filtered2 <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season) <span class="sc">%&gt;%</span> <span class="co">#process by season</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> <span class="co"># cut into groups</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">lm_tmin =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">lm</span>(tmin <span class="sc">~</span> year, <span class="at">data =</span> .)), <span class="co">#fit model for each group</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tmin_tidy =</span> purrr<span class="sc">::</span><span class="fu">map</span>(lm_tmin, broom<span class="sc">::</span>tidy) <span class="co">#summarize model for each group</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(tmin_tidy) <span class="sc">%&gt;%</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;year&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data, <span class="sc">-</span>lm_tmin) <span class="sc">%&gt;%</span> </span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">season</th>
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Spring</td>
<td style="text-align: left;">year</td>
<td style="text-align: right;">0.0157025</td>
<td style="text-align: right;">0.0032314</td>
<td style="text-align: right;">4.859407</td>
<td style="text-align: right;">1.2e-06</td>
</tr>
<tr class="even">
<td style="text-align: left;">Summer</td>
<td style="text-align: left;">year</td>
<td style="text-align: right;">0.0233772</td>
<td style="text-align: right;">0.0017552</td>
<td style="text-align: right;">13.318941</td>
<td style="text-align: right;">0.0e+00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fall</td>
<td style="text-align: left;">year</td>
<td style="text-align: right;">0.0141380</td>
<td style="text-align: right;">0.0030396</td>
<td style="text-align: right;">4.651252</td>
<td style="text-align: right;">3.4e-06</td>
</tr>
<tr class="even">
<td style="text-align: left;">Winter</td>
<td style="text-align: left;">year</td>
<td style="text-align: right;">0.0179402</td>
<td style="text-align: right;">0.0029273</td>
<td style="text-align: right;">6.128633</td>
<td style="text-align: right;">0.0e+00</td>
</tr>
</tbody>
</table>
</section>
<section id="autoregressive-models" class="slide level2">
<h2>Autoregressive models</h2>
<p>See <a href="https://cran.r-project.org/web/views/TimeSeries.html">Time Series Analysis Task View</a> for summary of available pack,-ages/models.</p>
<ul>
<li>Moving average (MA) models</li>
<li>autoregressive (AR) models</li>
<li>autoregressive moving average (ARMA) models</li>
<li>frequency analysis</li>
<li>Many, many more…</li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="climate-metrics" class="title-slide slide level1">
<h1>Climate Metrics</h1>

</section>
<section id="climate-metrics-climdex" class="slide level2">
<h2>Climate Metrics: ClimdEX</h2>
<p>Indices representing extreme aspects of climate derived from daily data:</p>
<p>Climate Change Research Centre (CCRC) at University of New South Wales (UNSW) (<a href="http://www.climdex.org">climdex.org</a>).</p>
</section>
<section id="core-indices" class="slide level2">
<h2>27 Core indices</h2>
<p>For example:</p>
<ul>
<li><strong>FD</strong> Number of frost days: Annual count of days when TN (daily minimum temperature) &lt; 0C.</li>
<li><strong>SU</strong> Number of summer days: Annual count of days when TX (daily maximum temperature) &gt; 25C.</li>
<li><strong>ID</strong> Number of icing days: Annual count of days when TX (daily maximum temperature) &lt; 0C.</li>
<li><strong>TR</strong> Number of tropical nights: Annual count of days when TN (daily minimum temperature) &gt; 20C.</li>
<li><strong>GSL</strong> Growing season length: Annual (1st Jan to 31st Dec in Northern Hemisphere (NH), 1st July to 30th June in Southern Hemisphere (SH)) count between first span of at least 6 days with daily mean temperature TG&gt;5C and first span after July 1st (Jan 1st in SH) of 6 days with TG&lt;5C.</li>
<li><strong>TXx</strong> Monthly maximum value of daily maximum temperature</li>
<li><strong>TN10p</strong> Percentage of days when TN &lt; 10th percentile</li>
<li><strong>Rx5day</strong> Monthly maximum consecutive 5-day precipitation</li>
<li><strong>SDII</strong> Simple pricipitation intensity index</li>
</ul>
</section>
<section id="climdex-indices" class="slide level2">
<h2>Climdex indices</h2>
<p><a href="http://www.climdex.org/indices.html">ClimDex</a></p>
</section>
<section id="format-data-for-climdex" class="slide level2">
<h2>Format data for <code>climdex</code></h2>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PCICt)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Parse the dates into PCICt.</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>pc.dates <span class="ot">&lt;-</span> <span class="fu">as.PCICt</span>(<span class="fu">as.POSIXct</span>(d_filtered<span class="sc">$</span>date),<span class="at">cal=</span><span class="st">&quot;gregorian&quot;</span>)</span></code></pre></div>
</section>
<section id="generate-the-climdex-object" class="slide level2">
<h2>Generate the climdex object</h2>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(climdex.pcic)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    ci <span class="ot">&lt;-</span> <span class="fu">climdexInput.raw</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">tmax=</span>d_filtered<span class="sc">$</span>tmax,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">tmin=</span>d_filtered<span class="sc">$</span>tmin,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prec=</span>d_filtered<span class="sc">$</span>prcp,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>      pc.dates,pc.dates,pc.dates, </span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">base.range=</span><span class="fu">c</span>(<span class="dv">1971</span>, <span class="dv">2000</span>))</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>years<span class="ot">=</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(<span class="fu">unique</span>(ci<span class="sc">@</span>date.factors<span class="sc">$</span>annual)))</span></code></pre></div>
</section>
<section id="cumulative-dry-days" class="slide level2">
<h2>Cumulative dry days</h2>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>cdd<span class="ot">=</span> <span class="fu">climdex.cdd</span>(ci, <span class="at">spells.can.span.years =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cdd<span class="sc">~</span>years,<span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-43-1.png" /></p>
</section>
<section id="diurnal-temperature-range" class="slide level2">
<h2>Diurnal Temperature Range</h2>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>dtr<span class="ot">=</span><span class="fu">climdex.dtr</span>(ci, <span class="at">freq =</span> <span class="fu">c</span>(<span class="st">&quot;annual&quot;</span>))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dtr<span class="sc">~</span>years,<span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-44-1.png" /></p>
</section>
<section id="frost-days" class="slide level2">
<h2>Frost Days</h2>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>fd<span class="ot">=</span><span class="fu">climdex.fd</span>(ci)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fd<span class="sc">~</span>years,<span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img data-src="PS_09_files/figure-revealjs/unnamed-chunk-45-1.png" /></p>
</section></section>
    </div>
  </div>

  <script src="externals/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="externals/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Enable slide navigation via mouse wheel
        mouseWheel: false,
        // Opens links in an iframe preview overlay
        previewLinks: true,
        // Transition style
        transition: 'zoom', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: '90%',
        height: '90%',
        // Factor of the display size that should remain empty around the content
        margin: 0.1,
        // Bounds for smallest/largest possible scale to apply to content
        minScale: 1,
        maxScale: 3,



        chalkboard: {
        },

        keyboard: {
          67: function() { RevealChalkboard.toggleNotesCanvas() },    // toggle notes canvas when 'c' is pressed
          66: function() { RevealChalkboard.toggleChalkboard() }, // toggle chalkboard when 'b' is pressed
          46: function() { RevealChalkboard.clear() },    // clear chalkboard when 'DEL' is pressed
           8: function() { RevealChalkboard.reset() },    // reset chalkboard data on current slide when 'BACKSPACE' is pressed
          68: function() { RevealChalkboard.download() }, // downlad recorded chalkboard drawing when 'd' is pressed
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: 'externals/reveal.js-3.3.0.1/plugin/zoom-js/zoom.js', async: true },
          { src: 'externals/reveal.js-3.3.0.1/plugin/chalkboard/chalkboard.js', async: true },
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
